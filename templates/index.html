<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Cripto Preços e TVL</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 30px; }
        .card { background: #f5f5f5; padding: 20px; margin: 10px 0; border-radius: 10px; }
    </style>
</head>
<body>
    <h1>Preços em Tempo Real (USD)</h1>

    <div class="card">
        <strong>Bitcoin (BTC):</strong> $<span id="btc">...</span>
    </div>
    <div class="card">
        <strong>Ethereum (ETH):</strong> $<span id="eth">...</span>
    </div>
    <div class="card">
        <strong>Cardano (ADA):</strong> $<span id="ada">...</span>
    </div>

    <p style="color: gray;">Atualizando a cada 10 segundos...</p>

    <h2>Top 10 Criptos com Maior TVL (via DeFiLlama)</h2>
    <ul id="tvl-list"></ul>

    <script>
        async function atualizarPrecos() {
            try {
                const res = await fetch('/api/precos');
                const data = await res.json();
                document.getElementById('btc').innerText = data.bitcoin.usd.toLocaleString();
                document.getElementById('eth').innerText = data.ethereum.usd.toLocaleString();
                document.getElementById('ada').innerText = data.cardano.usd.toLocaleString();
            } catch (err) {
                console.error("Erro ao buscar preços:", err);
            }
        }

        async function carregarTVL() {
            try {
                const res = await fetch('/api/tvl');
                const dados = await res.json();
                const ul = document.getElementById('tvl-list');
                ul.innerHTML = '';

                dados.forEach(cripto => {
                    const li = document.createElement('li');
                    const tvlFormatado = cripto.tvl.toLocaleString('en-US', { style: 'currency', currency: 'USD' });

                    if (cripto.url) {
                        li.innerHTML = `<a href="${cripto.url}" target="_blank">${cripto.name}</a>: ${tvlFormatado}`;
                    } else {
                        li.innerText = `${cripto.name}: ${tvlFormatado}`;
                    }

                    ul.appendChild(li);
                });
            } catch (err) {
                console.error("Erro ao buscar TVL:", err);
            }
        }

        atualizarPrecos();
        carregarTVL();
        setInterval(atualizarPrecos, 10000);
    </script>
</body>
</html>